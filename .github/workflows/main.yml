name: Convert Markdown to PDF

on:
  push:
    paths:
      - "cv.md" # Triggers the workflow only when cv.md is modified

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Pandoc and LaTeX
        run: |
          sudo apt-get update
          sudo apt install \
            pandoc \
            texlive-latex-base \
            texlive-fonts-recommended \
            texlive-extra-utils \
            texlive-latex-extra \
            texlive-xetex \
            fonts-ubuntu

      - name: Update Font Cache
        run: sudo fc-cache -fv

      - name: Convert Markdown to PDF
        run: pandoc cv.md -o cv.pdf --pdf-engine=xelatex

      # - name: Commit and Push PDF
      #   run: |
      #     git config --local user.email "action@github.com"
      #     git config --local user.name "GitHub Action"
      #     git add cv.pdf
      #     git commit -m "Update cv.pdf" || echo "No changes to commit"
      #     git push
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y%m%d%H%M%S')"

      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ steps.date.outputs.date }}
          release_name: Release ${{ steps.date.outputs.date }}
          draft: false
          prerelease: false

      - name: Upload Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./cv.pdf
          asset_name: cv.pdf
          asset_content_type: application/pdf
